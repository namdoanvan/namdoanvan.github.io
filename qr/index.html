<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>QR Code Scanner - Mở tab nhạc duy nhất</title>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <style>
    #reader {
      width: 320px;
      height: 320px;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>
  <h2>Quét QR Code để mở nhạc (mở 1 tab duy nhất)</h2>
  <div id="reader"></div>

  <script>
    let musicWindow = null;

    Html5Qrcode.getCameras().then(devices => {
      if (devices.length) {
        const html5QrCode = new Html5Qrcode("reader");

        html5QrCode.start(
          devices[0].id,
          { fps: 10, qrbox: 250 },
          (decodedText, decodedResult) => {
            console.log("QR Code scanned:", decodedText);
			alert(decodedText);

            if (!musicWindow || musicWindow.closed) {
              musicWindow = window.open(decodedText, "musicPlayerTab");
            } else {
              musicWindow.location.href = decodedText;
              musicWindow.focus();
            }
          },
          (errorMessage) => {
            // Lỗi quét có thể bỏ qua
          }
        ).catch(err => {
          console.error("Lỗi khi bắt đầu quét:", err);
          alert("Không thể bắt đầu quét QR Code: " + err);
        });

      } else {
        alert("Không tìm thấy camera");
      }
    }).catch(err => {
      alert("Lỗi lấy camera: " + err);
    });
  </script>
</body>
</html>
